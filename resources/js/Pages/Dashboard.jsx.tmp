import AuthenticatedLayout from '@/Layouts/AuthenticatedLayout';
import { Head } from '@inertiajs/react';
import Card from '@/Components/UI/Card';
import StatCard from '@/Components/UI/StatCard';
import Table from '@/Components/UI/Table';
import { 
    UserGroupIcon, 
    AcademicCapIcon, 
    BookOpenIcon,
    DocumentTextIcon
} from '@heroicons/react/24/outline';

export default function Dashboard({ auth, metrics = {}, recent_results = [], class_distribution = [], latest_activities = [] }) {
    const columns = [
        { key: 'student', label: 'Student', render: (row) => row.student.user.name },
        { key: 'subject', label: 'Subject', render: (row) => row.subject.name },
        { key: 'total_score', label: 'Score' },
        { 
            key: 'created_at', 
            label: 'Date', 
            render: (row) => new Date(row.created_at).toLocaleDateString() 
        }
    ];

    return (
        <AuthenticatedLayout>
            <Head>
                <title>Dashboard - SMS</title>
            </Head>

            <div className="space-y-6">
                {/* Stats Section */}
                <div className="grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-4">
                    <StatCard
                        title="Total Students"
                        value={metrics.total_students || 0}
                        icon={UserGroupIcon}
                    />
                    <StatCard
                        title="Total Classes"
                        value={metrics.total_classes || 0}
                        icon={AcademicCapIcon}
                    />
                    <StatCard
                        title="Total Subjects"
                        value={metrics.total_subjects || 0}
                        icon={BookOpenIcon}
                    />
                    <StatCard
                        title="Total Results"
                        value={metrics.total_results || 0}
                        icon={DocumentTextIcon}
                    />
                </div>

                {/* Main Content */}
                <div className="grid grid-cols-1 gap-6 lg:grid-cols-2">
                    {/* Recent Results */}
                    <Card>
                        <div className="flex items-center justify-between mb-4">
                            <h2 className="text-lg font-semibold text-gray-900">Recent Results</h2>
                        </div>
                        <Table
                            columns={columns}
                            data={recent_results}
                        />
                    </Card>

                    {/* Class Distribution */}
                    <Card>
                        <div className="flex items-center justify-between mb-4">
                            <h2 className="text-lg font-semibold text-gray-900">Class Distribution</h2>
                        </div>
                        <div className="space-y-4">
                            {class_distribution.map((classroom) => (
                                <div key={classroom.name} className="flex items-center">
                                    <span className="flex-1 text-sm font-medium text-gray-600">
                                        {classroom.name}
                                    </span>
                                    <div className="ml-4 flex-1">
                                        <div className="relative h-2 bg-gray-200 rounded-full">
                                            <div
                                                className="absolute h-2 bg-indigo-600 rounded-full"
                                                style={{
                                                    width: `${(classroom.student_count / Math.max(...class_distribution.map(c => c.student_count))) * 100}%`
                                                }}
                                            />
                                        </div>
                                    </div>
                                    <span className="ml-4 text-sm font-medium text-gray-600">
                                        {classroom.student_count} students
                                    </span>
                                </div>
                            ))}
                        </div>
                    </Card>
                </div>

                {/* Activities */}
                <Card>
                    <div className="flex items-center justify-between mb-4">
                        <h2 className="text-lg font-semibold text-gray-900">Latest Activities</h2>
                    </div>
                    <div className="flow-root">
                        <ul role="list" className="-mb-8">
                            {latest_activities.map((activity, activityIdx) => (
                                <li key={activity.date}>
                                    <div className="relative pb-8">
                                        {activityIdx !== latest_activities.length - 1 ? (
                                            <span
                                                className="absolute top-4 left-4 -ml-px h-full w-0.5 bg-gray-200"
                                                aria-hidden="true"
                                            />
                                        ) : null}
                                        <div className="relative flex space-x-3">
                                            <div>
                                                <span className="h-8 w-8 rounded-full bg-indigo-100 flex items-center justify-center">
                                                    <DocumentTextIcon className="h-5 w-5 text-indigo-600" />
                                                </span>
                                            </div>
                                            <div className="flex min-w-0 flex-1 justify-between space-x-4 pt-1.5">
                                                <div>
                                                    <p className="text-sm text-gray-600">{activity.message}</p>
                                                </div>
                                                <div className="whitespace-nowrap text-right text-sm text-gray-500">
                                                    {new Date(activity.date).toLocaleDateString()}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </li>
                            ))}
                        </ul>
                    </div>
                </Card>
            </div>
        </AuthenticatedLayout>
    );
}
